# Feature Specification: Отслеживание прогресса проектов из Kaiten

**Feature Branch**: `001-kaiten-progress-tracker`  
**Created**: 2025-02-02  
**Status**: Draft  
**Input**: User description: "мы делаем веб-приложение, которое фиксирует общий прогресс проектов из Kaiten."

## User Scenarios & Testing *(mandatory)*

### User Story 1 - Просмотр прогресса проектов по этапам (Priority: P1)

Пользователь (арт-директор, дизайнер, продюсер) открывает веб-приложение и видит список своих проектов. Для каждого проекта отображается прогресс-бар с этапами, где видно на каком этапе находится проект и насколько закрыт каждый этап на основе статуса задач из Kaiten. Пользователь может кликнуть на ячейку этапа в таймлайне и увидеть детальную информацию: название этапа, количество задач и их статус (выполнено/не выполнено), даты начала и окончания. При наведении на ячейку этапа показываются даты начала и окончания.

**Why this priority**: Это основная ценность приложения - визуализация прогресса проектов. Без этой функции приложение не имеет смысла. Это минимально жизнеспособный продукт (MVP).

**Independent Test**: Можно полностью протестировать, создав тестовый проект с этапами и задачами вручную (без интеграции с Kaiten) и проверив отображение прогресса. Доставляет ценность - пользователь видит состояние своих проектов.

**Acceptance Scenarios**:

1. **Given** пользователь открыл приложение, **When** просматривает список проектов, **Then** видит прогресс-бар для каждого проекта с этапами
2. **Given** проект имеет этапы с задачами, **When** пользователь смотрит на прогресс-бар, **Then** видит процент заполнения каждого этапа на основе закрытых задач из Kaiten
3. **Given** пользователь наводит курсор на ячейку этапа, **When** происходит наведение, **Then** отображаются даты начала и окончания этапа
4. **Given** пользователь кликает на ячейку этапа, **When** открывается детальный вид, **Then** видит название этапа, количество задач, статус задач (выполнено/не выполнено), даты начала и окончания

---

### User Story 2 - Создание проектов и привязка к Kaiten API (Priority: P2)

Пользователь создаёт новый проект в приложении и сразу привязывает к нему этапы и задачи из Kaiten через API. При создании проекта пользователь указывает связь с данными из Kaiten, и система синхронизирует этапы и задачи. Пользователь может видеть задачи из Kaiten внутри каждого этапа.

**Why this priority**: Без возможности создания проектов и синхронизации с Kaiten приложение не может функционировать. Это критическая функция для работы с реальными данными.

**Independent Test**: Можно протестировать, создав проект и привязав его к тестовым данным Kaiten API (или моковым данным). Проверить, что этапы и задачи отображаются корректно. Доставляет ценность - пользователь может начать использовать приложение со своими реальными проектами.

**Acceptance Scenarios**:

1. **Given** пользователь находится в приложении, **When** создаёт новый проект, **Then** может указать связь с проектом/этапами/задачами из Kaiten API
2. **Given** пользователь создал проект с привязкой к Kaiten, **When** система синхронизирует данные, **Then** этапы и задачи из Kaiten отображаются в проекте
3. **Given** проект привязан к Kaiten, **When** пользователь открывает этап, **Then** видит список задач из Kaiten внутри этого этапа
4. **Given** данные в Kaiten изменились, **When** пользователь обновляет синхронизацию, **Then** изменения отражаются в приложении

---

### User Story 3 - Управление проектами и этапами (Priority: P3)

Пользователь управляет созданными проектами: переименовывает, удаляет или завершает проекты. Внутри проектов пользователь может переименовывать и удалять этапы. Если в Kaiten изменилась структура или названия этапов, пользователь может перепривязать этапы внутри проектов. Пользователь может устанавливать дату начала и окончания для этапа или проекта.

**Why this priority**: Управление данными необходимо для поддержания актуальности информации. Без этого пользователь не сможет поддерживать проекты в актуальном состоянии при изменениях в Kaiten.

**Independent Test**: Можно протестировать, создав проект с этапами и проверив все операции управления (переименование, удаление, завершение, установка дат). Доставляет ценность - пользователь может поддерживать структуру проектов актуальной.

**Acceptance Scenarios**:

1. **Given** пользователь имеет созданный проект, **When** переименовывает проект, **Then** новое название сохраняется и отображается
2. **Given** пользователь имеет проект, **When** удаляет проект, **Then** проект удаляется из списка после подтверждения
3. **Given** пользователь имеет проект, **When** завершает проект, **Then** проект помечается как завершённый и перемещается в архив
4. **Given** пользователь имеет этап в проекте, **When** переименовывает этап, **Then** новое название сохраняется
5. **Given** пользователь имеет этап в проекте, **When** удаляет этап, **Then** этап удаляется из проекта
6. **Given** структура этапов в Kaiten изменилась, **When** пользователь перепривязывает этапы, **Then** этапы обновляются согласно новой структуре из Kaiten
7. **Given** пользователь имеет проект или этап, **When** устанавливает дату начала и окончания, **Then** даты сохраняются и отображаются в таймлайне

---

### User Story 4 - Управление состоянием этапов и архивация (Priority: P4)

Пользователь может поставить этап на паузу с указанием причины. Причину паузы можно редактировать. Пользователь может отправлять проекты в архив. Архивные проекты не отображаются в основном списке, но доступны для просмотра.

**Why this priority**: Эти функции повышают удобство управления проектами, но не являются критичными для базовой функциональности. Можно реализовать после основных функций.

**Independent Test**: Можно протестировать, создав проект с этапами, поставив этап на паузу с причиной, отредактировав причину, и отправив проект в архив. Проверить, что архивные проекты скрыты в основном списке. Доставляет ценность - пользователь может управлять активными и неактивными проектами.

**Acceptance Scenarios**:

1. **Given** пользователь имеет активный этап, **When** ставит этап на паузу и указывает причину, **Then** этап помечается как на паузе, причина сохраняется и отображается
2. **Given** этап находится на паузе, **When** пользователь редактирует причину паузы, **Then** обновлённая причина сохраняется
3. **Given** пользователь имеет проект, **When** отправляет проект в архив, **Then** проект перемещается в архив и не отображается в основном списке
4. **Given** пользователь имеет архивные проекты, **When** открывает раздел архива, **Then** видит список архивных проектов

---

### Edge Cases

- Что происходит, когда Kaiten API недоступен при создании проекта? **Решение**: Показывается сообщение об ошибке с возможностью повторить попытку (retry). Данные проекта сохраняются, но без синхронизации с Kaiten. Пользователь может синхронизировать позже через кнопку обновления.

- Как система обрабатывает ситуацию, когда этап в Kaiten был удалён, но привязан к проекту в приложении? **Решение**: Этап помечается как "недоступен в Kaiten" с визуальным предупреждением в таймлайне. Пользователь может перепривязать этап к другой группе Kaiten или удалить этап из проекта.

- Что происходит, когда задачи в Kaiten изменили статус, но синхронизация ещё не выполнена? **Решение**: Прогресс отображается на основе последних синхронизированных данных. Пользователь может обновить данные кнопкой "Обновить из Kaiten". При следующей синхронизации прогресс обновится автоматически.

- Как система обрабатывает параллельные этапы с перекрывающимися датами в таймлайне? **Решение**: Параллельные этапы (или их части) с перекрывающимися датами отображаются друг под другом в отдельных горизонтальных рядах. Каждый ряд смещён вправо относительно предыдущего, чтобы визуально показать последовательность и параллельность выполнения.

- Что происходит, когда пользователь устанавливает дату окончания этапа раньше даты начала? **Решение**: Система валидирует даты и показывает предупреждение пользователю. Сохранение блокируется до исправления дат (endDate должна быть >= startDate).

- Как система обрабатывает ситуацию, когда в Kaiten появились новые этапы после первоначальной привязки? **Решение**: Пользователь может перепривязать этапы через UI (кнопка "Перепривязать этапы" в ProjectDetails). Система показывает текущие этапы проекта и новые группы в Kaiten для сопоставления.

- Что происходит, когда проект имеет много этапов (50+) - как отображается прогресс-бар? **Решение**: Таймлайн использует виртуализацию для рендеринга только видимых этапов. Параллельные этапы группируются для оптимизации layout. При необходимости добавляется пагинация или скролл.

- Как система обрабатывает ситуацию, когда этап на паузе, но задачи в Kaiten продолжают обновляться? **Решение**: Прогресс этапа на паузе не обновляется автоматически, но данные синхронизируются при ручной синхронизации. После снятия с паузы прогресс пересчитывается на основе актуальных данных из Kaiten.

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: Система ДОЛЖНА отображать список проектов пользователя с прогресс-барами по этапам
- **FR-002**: Система ДОЛЖНА рассчитывать процент заполнения этапа на основе статуса задач из Kaiten API
- **FR-003**: Система ДОЛЖНА отображать таймлайн проекта с датами начала и окончания
- **FR-004**: Система ДОЛЖНА показывать даты начала и окончания этапа при наведении на ячейку этапа
- **FR-005**: Система ДОЛЖНА отображать детальную информацию об этапе при клике на ячейку: название, количество задач, статус задач, даты
- **FR-006**: Пользователи ДОЛЖНЫ иметь возможность создавать новые проекты
- **FR-007**: Система ДОЛЖНА поддерживать привязку этапов и задач из Kaiten API при создании проекта
- **FR-008**: Система ДОЛЖНА синхронизировать данные с Kaiten API
- **FR-009**: Система ДОЛЖНА отображать задачи из Kaiten внутри каждого этапа
- **FR-010**: Пользователи ДОЛЖНЫ иметь возможность переименовывать проекты
- **FR-011**: Пользователи ДОЛЖНЫ иметь возможность удалять проекты
- **FR-012**: Пользователи ДОЛЖНЫ иметь возможность завершать проекты
- **FR-013**: Пользователи ДОЛЖНЫ иметь возможность переименовывать этапы внутри проектов
- **FR-014**: Пользователи ДОЛЖНЫ иметь возможность удалять этапы внутри проектов
- **FR-015**: Пользователи ДОЛЖНЫ иметь возможность перепривязывать этапы при изменении структуры в Kaiten
- **FR-016**: Пользователи ДОЛЖНЫ иметь возможность ставить этапы на паузу с указанием причины
- **FR-017**: Пользователи ДОЛЖНЫ иметь возможность редактировать причину паузы этапа
- **FR-018**: Пользователи ДОЛЖНЫ иметь возможность отправлять проекты в архив
- **FR-019**: Система ДОЛЖНА скрывать архивные проекты из основного списка
- **FR-020**: Пользователи ДОЛЖНЫ иметь возможность просматривать архивные проекты в отдельном разделе
- **FR-021**: Пользователи ДОЛЖНЫ иметь возможность устанавливать дату начала и окончания для этапа
- **FR-022**: Пользователи ДОЛЖНЫ иметь возможность устанавливать дату начала и окончания для проекта
- **FR-023**: Система ДОЛЖНА корректно отображать параллельные этапы с перекрывающимися датами в таймлайне, размещая их друг под другом в отдельных горизонтальных рядах с визуальным смещением для отображения последовательности
- **FR-024**: Система ДОЛЖНА обеспечивать закрытый доступ к приложению через единый пароль на уровне приложения (HTTP Basic Auth или простая форма на главной странице)

### Key Entities *(include if feature involves data)*

- **Project (Проект)**: Представляет проект пользователя. Имеет название, даты начала и окончания, список этапов, статус (активный/завершённый/архивный). Связан с данными из Kaiten через API.
- **Stage (Этап)**: Представляет этап проекта. Имеет название, даты начала и окончания, список задач, статус (активный/на паузе/завершённый), причину паузы (если применимо). Привязан к этапу в Kaiten через API.
- **Task (Задача)**: Представляет задачу из Kaiten. Имеет идентификатор из Kaiten, название, статус (выполнено/не выполнено). Синхронизируется с Kaiten API. Принадлежит этапу.

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: Пользователь может просмотреть прогресс всех своих проектов за менее чем 3 секунды после открытия приложения
- **SC-002**: Процент заполнения этапа рассчитывается и отображается корректно на основе статуса задач из Kaiten в 100% случаев
- **SC-003**: Синхронизация данных с Kaiten API выполняется успешно в 95% случаев при доступности API
- **SC-004**: Пользователь может создать новый проект и привязать его к Kaiten за менее чем 2 минуты
- **SC-005**: Все операции управления проектами и этапами (переименование, удаление, завершение) выполняются успешно в 100% случаев
- **SC-006**: Таймлайн корректно отображает до 20 параллельных этапов без визуальных конфликтов
- **SC-007**: Пользователь может найти и просмотреть архивный проект за менее чем 10 секунд

## Assumptions

- Приложение является личным инструментом без регистрации и авторизации отдельных пользователей
- Доступ к приложению контролируется единым паролем на уровне приложения
- Kaiten API доступен и предоставляет необходимые endpoints для получения проектов, этапов и задач
- Пользователь имеет доступ к Kaiten API с соответствующими credentials
- Данные хранятся локально или в cloud storage (Supabase или эквивалент)
- Приложение работает в современных веб-браузерах
- Пользователь работает с ограниченным количеством проектов (до 50 проектов одновременно)
- Каждый проект может содержать до 20 этапов
- Каждый этап может содержать до 100 задач

## Dependencies

- Доступность Kaiten API для синхронизации данных
- Наличие credentials для доступа к Kaiten API
- Доступность backend/storage решения (Supabase или эквивалент) для хранения данных проектов
- Наличие Figma UI kit через Figma MCP для компонентов интерфейса
  - UI-kit: https://www.figma.com/design/pj5aiXE1X40rEoVbtyVQ2F/Turbo?node-id=0-1